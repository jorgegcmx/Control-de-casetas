<?php include_once 'header.php'; ?>


<div class="row">
    <div class="col-lg-12">
        <div class="panel panel-default">
            <div class='alert alert-info'>
                <strong>Apartado que permite agregar la calificación a los Alumnos</strong>
            </div>
            <div class="panel-body">
                <table data-toggle="table" data-show-refresh="true" data-show-toggle="true" data-show-columns="true"
                    data-search="true" data-select-item-name="toolbar1" data-pagination="true" data-sort-name="name"
                    data-sort-order="desc">
                    <thead>
                        <tr>
                            <th>Tus Grupos</th>
                            <th>Opciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <?php	
                       while($fila = $datos->fetchObject()){
                        ?>
                        <tr>

                            <td><?php echo "$fila->grupo"; 
                                    echo "_de_$fila->fechainicio";
                                    echo "_a_$fila->fechatermino";  
                                    ?></td>
                            <td>
                                <form class="form-inline" action="index" method="POST">
                                    <input type="hidden" value="<?php echo $fila->idgrupos;?>" name="id">
                                    <input type="hidden" value="<?php 
                                      echo "$fila->grupo"; 
                                      echo "_de_$fila->fechainicio";
                                      echo "_a_$fila->fechatermino";
                                     ?>" name="grupo">
                                    <select required class="form-control" name="ciclo">
                                        <option value="">Selecciona el Ciclo</option>
                                        <?php
                                          $usu2 = new classe();
                                         $periodos = $usu2->get_periodos($USER);
                                         while($fil = $periodos->fetchObject()){
                                         ?>
                                        <option value="<?php echo $fil->idperiodos; ?>">
                                         <?php echo $fil->periodoescolar; echo" ";  echo $fil->anio; ?></option>
                                        <?php
                                         }
                                         ?>
                                    </select>
                                    <button type="submit" class="btn btn-info"><span
                                            class="glyphicon glyphicon-search"></span></button>
                                </form>
                            </td>
                        </tr>
                        <?php
                         
                         }
                         ?>

                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="col-lg-12">
        <div class="panel panel-default">
            <div class='alert alert-warning'>
                <strong>A continuación se cargará la información, correspondiente, al grupo que selecione </strong>
                <p>Nota: No olvides ingresar la calificación, correcta ya que no se permitira editar despues de guardar,
                    para poder editar debes comunicarte con el administrador del sistema</p>
            </div>
            <?php
              include_once 'classe.php';
              $usu = new classe();
    
              if(isset($_POST['id']) and isset($_POST['grupo']) ){
                $id=$_POST['id'];
                $grupo=$_POST['grupo'];
                echo"<div class='alert alert-success'><strong>Exito!!!</strong> Información Cargada Correctamente.</div>";		  
               ?>
            <div class="panel-body">
                <div class="col-md-12">
                    <form role="form" action="agregar.php" method="POST">
                        <?php		
                         echo" <div class='form-group'><label>Grupo</label>
                         <input value='".$id."' class='form-control' type='hidden' readonly='readonly' name='grupos_idgrupos' required >
                              <h4>".$grupo."</h4>";
                              $ciclo=$_POST['ciclo'];     
                          ?>
                        <input type="hidden" class="form-control" name="ciclo" value="<?php echo $ciclo;?>">
                        <select name="materias_idmaterias" class="form-control" required>
                            <option value="">Selecciona la materia</option>
                            <?php
                        include_once 'classe.php';
                        $mat = new classe();
                        $cedula= $_SESSION['cedula'];                  
                        $datoss=$mat->get_mat($cedula,$id);
                        while($filass = $datoss->fetchObject()){  
                        
                         ?>
                            <option value="<?php echo $filass->idmaterias; ?>"><?php echo $filass->materia; ?></option>
                            <?php							 
                         }
                         ?>
                        </select>

                        <select name="parcial_idparcial" class="form-control" required>
                            <option value="">Selecciona el Parcial a Calificar</option>
                            <?php
                                    $parcial = new classe();
                                    $fil = $parcial->get_parcial($USER);								
                                    while($dat=$fil->fetchObject()){ 
                        
                         ?>

                            <option value="<?php echo $dat->idparcial; ?>">
                                <?php echo $dat->parcialcol." ".$dat->porcentage; ?>%</option>
                            <?php							 
                         }
                         ?>
                        </select>



                        <table data-toggle="table" data-show-refresh="true" data-show-toggle="true"
                            data-show-columns="true" data-select-item-name="toolbar1" data-pagination="true"
                            data-sort-name="name" data-sort-order="desc">
                            <thead>
                                <tr>
                                    <th>Foto</th>
                                    <th>Calificaciones</th>
                                    <th>Nombre Alumnos</th>
                                    <th>Calificación</th>
                                </tr>
                            </thead>
                            <tbody>
                              <?php
                                 $alumno = $usu->get_alum($id,$ciclo);
                              while($filas = $alumno->fetchObject()){ 
                                                                                        
                               ?>
                                <tr>
                                    <td><img class="media-object img-thumbnail user-img" alt="User Picture" width="100"
                                            height="100" src="../Alumnos/<?php echo $filas->foto; ?>">
                                    </td>
                                    <td>
                                        <table>
                                            <tr>
                                                <th><small>Materias</small></th>
                                                <?php
                                                 $par = new classe();
                                                 $p = $par->get_parcial($USER);										
                                                 while($pr=$p->fetchObject()){
                                                 ?>
                                                <th><small><?php echo $pr->parcialcol." ".$pr->porcentage; ?>%</small>
                                                </th>
                                                <?php }?>
                                                <th><small>Final</small></th>

                                            </tr>
                                            <?php 
                                             $mt = new classe();
                                             $da=$mt->get_mat($cedula,$id);
                                             while($f = $da->fetchObject()){   
                                             ?>
                                            <tr>
                                                <td><small><?php echo $f->materia; ?></small></td>
                                                <?php
                                                $numero_de_perciales_diferente_de_vacio=0;
                                                $valor_porcentual=0;   
                                                $calificacion_final=0;
                                                $calificacion_final_3notas=0;
                                                $calificacion_final_2notas=0;
                                                
                                                $valor_3=0;
                                                $valor_5=0;
                                                $calificacion_final_indice_3_5=0;

                                                  $par = new classe();
                                                  $p = $par->get_parcial($USER);										
                                                  while($pr=$p->fetchObject()){                                                 
      
                                                  ?>
                                                <td>
                                                <?php 
                                                $num_condicion=$pu->num_condicion;
										 
                                                $valor_porcentual=($pu->porcentage/100);
                                                $calificacion_por_parcial=0; 
   
                                                  $calificacion = new classe(); 
                                                  $cali=$calificacion->get_calificacion( $f->idmaterias,$pr->idparcial,$filas->idalumnos,$ciclo);	 
                                                  while($c = $cali->fetchObject()){
                                                  echo "<span class='label label-info'>".$c->calificacion."</span>";
                                                  $calificacion_por_parcial=$c->calificacion;                                        
                                                }
                                               
                                               
                                                /*evaluemos si solo tiene 2 calificaciones parcial 1-2*/
                                                  $calificacion_final_2notas=$calificacion_final_2notas+$calificacion_por_parcial;
                                                  
                                                  
                                                  
                                                 if(($calificacion_por_parcial<>0) && ($num_condicion==4)){
                                                     /*evaluamos si tiene tiene la calificacion parcial 4 valor de 100%*/
     
                                                   $valor_de_calificacion=0;
     
                                                   if($valor_porcentual<>0){
                                                      $valor_de_calificacion = $calificacion_por_parcial * $valor_porcentual;
                                                       /*Calificacion * valor %*/
                                                      $calificacion_final = $calificacion_final + $valor_de_calificacion;
                                                   }
                                                  
                                                      
                                                      
                                                  }else{
                                                     /*evaluamos si tiene tiene la calificacion parcial 1-3 valor de 20% 20% 60%*/
                                                      
                                                      $valor_de_calificacion=0;
                                                      
                                                      if(($calificacion_por_parcial<>0)&&($valor_porcentual<>0)){
                                                       $numero_de_perciales_diferente_de_vacio = $numero_de_perciales_diferente_de_vacio+1;
                                                        /*Calificacion * valor %*/
                                                       $valor_de_calificacion = $calificacion_por_parcial * $valor_porcentual; 
                                                 
                                                      }
                                                     
                                                      $calificacion_final_3notas=$calificacion_final_3notas+$valor_de_calificacion;
                                                      
                                                      /*Calificacion cuando se calcula entra parcial 3 y 5*/
                                                      
                                                       if(($calificacion_por_parcial<>0)&&($num_condicion==3)){
                                                            
                                                               $valor_de_calificacion=0;
                                                      
                                                                if(($calificacion_por_parcial<>0)&&($valor_porcentual<>0)){
                                                                    /*Calificacion * valor %*/
                                                                      $valor_3 = $calificacion_por_parcial * $valor_porcentual; 
                                                                      $valor_3;
                                                                    }
                                                                   
                                                        }
                                                       
                                                         if(($calificacion_por_parcial<>0)&&($num_condicion==5)){
                                                               
                                                               $valor_de_calificacion=0;
                                                      
                                                                if(($calificacion_por_parcial<>0)&&($valor_porcentual<>0)){
                                                                    /*Calificacion * valor %*/
                                                                     $valor_5 = $calificacion_por_parcial * $valor_porcentual; 
                                                                     $valor_5;
                                                                    }
                                                                   
                                                        }
                                                        
                                                       
                                                       if($valor_5<>0){
                                                            $calificacion_final_indice_3_5=$valor_5+$valor_3;
                                                       }else{
                                                           $calificacion_final_indice_3_5=0;
                                                       }
                                                       
                                                        
                                                      
                                                  } 
                                                  
                                                     
                                                ?>
                                                </td>
                                                <?php }?>
                                                <td>   
                                                    if($calificacion_final_indice_3_5<>0){
                                        
                                        if( $Calificacion_minima>$calificacion_final_indice_3_5){
                                             echo "<span class='label label-danger'>".$calificacion_final_indice_3_5."</span>";
                                        }else{
                                             echo "<span class='label label-info'>".round($calificacion_final_indice_3_5)."</span>" ;
                                        }
                                       
                                       
                                    }else{
                                         $numero_de_perciales_diferente_de_vacio; 
                                        
									   if($numero_de_perciales_diferente_de_vacio==3){
									       
									        if( $Calificacion_minima>$calificacion_final_3notas){
                                             echo "<span class='label label-danger'>".$calificacion_final_3notas."</span>";
                                            }else{
                                             echo "<span class='label label-info'>".round($calificacion_final_3notas)."</span>" ;
                                           }
									        
									   }elseif($numero_de_perciales_diferente_de_vacio==1){
									        
									        if( $Calificacion_minima>($calificacion_final_2notas/$numero_de_perciales_diferente_de_vacio)){
                                             echo "<span class='label label-danger'>".($calificacion_final_2notas/$numero_de_perciales_diferente_de_vacio)."</span>";
                                            }else{
                                             echo "<span class='label label-info'>".round($calificacion_final_2notas/$numero_de_perciales_diferente_de_vacio)."</span>" ;
                                           }
									        
									   }elseif($numero_de_perciales_diferente_de_vacio==2){
									        
									        if( $Calificacion_minima>($calificacion_final_2notas/$numero_de_perciales_diferente_de_vacio)){
                                             echo "<span class='label label-danger'>".($calificacion_final_2notas/$numero_de_perciales_diferente_de_vacio)."</span>";
                                            }else{
                                             echo "<span class='label label-info'>".round($calificacion_final_2notas/$numero_de_perciales_diferente_de_vacio)."</span>" ;
                                           }
									        
									   }else{
									       
									         if( $Calificacion_minima>$calificacion_final){
                                             echo "<span class='label label-danger'>".$calificacion_final."</span>";
                                            }else{
                                             echo "<span class='label label-info'>".round($calificacion_final)."</span>" ;
                                           }
									   } 									   
									  
                                    }
                                                </td>
                                            </tr>
                                            <?php } ?>
                                        </table>


                                    </td>
                                    <td><input type="hidden"
                                            value="<?php echo $filas->idalumnos; ?>"><b><?php echo $filas->nombrealumno; ?>
                                        </b></td>
                                    <td><input class="form-control" name="calificacion[<?php echo $filas->idalumnos;?>]"
                                            type="number" Required> </td>
                                </tr>
                                <?php							 
                                }
                               ?>
                            </tbody>
                        </table>
                        <button type="submit" class="btn btn-primary">Guardar</button>
                    </form>
                    <?php	}?>
                </div>
            </div>
        </div>
    </div>
</div>
<!--/.row-->
</div>
<!--/.main-->
<script src="../js/jquery-1.11.1.min.js"></script>
<script src="../js/bootstrap.min.js"></script>
<script src="../js/chart.min.js"></script>
<script src="../js/chart-data.js"></script>
<script src="../js/easypiechart.js"></script>
<script src="../js/easypiechart-data.js"></script>
<script src="../js/bootstrap-datepicker.js"></script>
<script src="../js/bootstrap-table.js"></script>
<script>
    /*	!function ($) {
            $(document).on("click","ul.nav li.parent > a > span.icon", function(){
                $(this).find('em:first').toggleClass("glyphicon-minus");
            });
            $(".sidebar span.icon").find('em:first').addClass("glyphicon-plus");
        }(window.jQuery);
    
        $(window).on('resize', function () {
          if ($(window).width() > 768) $('#sidebar-collapse').collapse('show')
        })
        $(window).on('resize', function () {
          if ($(window).width() <= 767) $('#sidebar-collapse').collapse('hide')
        })*/
</script>
<script type="text/javascript">
    function filterFloat(evt, input) {
        // Backspace = 8, Enter = 13, ‘0′ = 48, ‘9′ = 57, ‘.’ = 46, ‘-’ = 43
        var key = window.Event ? evt.which : evt.keyCode;
        var chark = String.fromCharCode(key);
        var tempValue = input.value + chark;
        if (key >= 48 && key <= 57) {
            if (filter(tempValue) === false) {
                return false;
            } else {
                return true;
            }
        } else {
            if (key == 8 || key == 13 || key == 0) {
                return true;
            } else if (key == 46) {
                if (filter(tempValue) === false) {
                    return false;
                } else {
                    return true;
                }
            } else {
                return false;
            }
        }
    }
    function filter(__val__) {
        var preg = /^([0-9]+\.?[0-9]{0,2})$/;
        if (preg.test(__val__) === true) {
            return true;
        } else {
            return false;
        }

    }

</script>
</body>

</html>